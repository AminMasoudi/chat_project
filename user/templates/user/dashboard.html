<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    {% load static %}
    <link rel="stylesheet" href="{% static 'user/styles.css' %}">

    <link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" rel="stylesheet">
    <script crossorigin="anonymous" src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"></script>


    <title>Dashboard</title>
</head>
<body class="w-body">

    <div class="user-info" id="user"></div>
    <div class="user-info">
        <button class="my-btn btn btn-primary">join to room</button>
        <button class="my-btn btn btn-primary">Build a new room</button>
    </div>
    <div id="pri_chats"></div>
    <hr id="hr" hidden></hr>
    <div id="pub_chats"></div>
        
    <script>
        user_info_api = `http://${window.location.host}/api/get_user_info`;
        user_private_chats = `http://${window.location.host}/api/get_chats_info`;
        public_chats = `http://${window.location.host}/api/public_chats`;

        document.addEventListener("DOMContentLoaded", (event)=> {
            fetch(user_info_api)
            .then(data => {
                if (!data.ok){
                    throw Error (data.status);
                }
                return data.json();
            }).then(value => {
                let user_box = document.getElementById("user")
                user_box.insertAdjacentHTML("beforeend",`
                <div class="user-box">
                    <h2>${value.username}</h2>
                </div>
                <div class="user-box">number of chats: ${value.rooms.length}</div>
                <div class="user-box">${value.date_joined}</div>
                `)
            })
            
            fetch(user_private_chats)
            .then(data => {
                if(!data.ok){
                    throw Error(data.status);
                }
                return data.json()
            }).then(value =>{
                let chats = document.getElementById("pri_chats") 
                value.forEach(chat => {
                    let p;
                    if (chat.is_private) {
                        p = "private"
                    }else{
                        p = "not Private"
                    }
                    chats.insertAdjacentHTML("afterbegin",`
                    <a class="chat-link" href="http://${window.location.host}/chat/${chat.pk}">
                        <div class="chat-box">
                            <h2 class="chat-info">${chat.name}</h2>    
                            <div class="chat-info pri">${p}</div>
                        </div>
                    </a>
                    `)
                }
                );
            })
            document.getElementById("hr").hidden = false

            fetch(public_chats)
            .then( data => {
                if (!data.ok){
                    throw Error(data.status)
                }
                return data.json();
            }).then( value => {
                let chats = document.getElementById("pub_chats") 
                value.forEach(chat => {
                    let p;
                    if (chat.is_private) {
                        p = "private"
                    }else{
                        p = "not Private"
                    }
                    chats.insertAdjacentHTML("afterbegin",`
                    <a class="chat-link" href="http://${window.location.host}/chat/${chat.pk}">
                        <div class="chat-box">
                            <h2 class="chat-info">${chat.name}</h2>    
                            <div class="chat-info pri">${p}</div>
                        </div>
                    </a>
                    `)
                }
                );
            })
            
        })
        
        
        
    /*
    TODO:
        - [ ] call api to get user info
        - [ ] call api to get chats data
    */
    </script>
</body>
</html> 